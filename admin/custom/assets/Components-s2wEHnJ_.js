import{j as s}from"./createSvgIcon-BG_YW-l7.js";import{C as i,D as c}from"./Delete-CyTfeNd-.js";import{C as o}from"./ConfigCustomTelegramSet__loadShare___mf_0_iobroker_mf_1_adapter_mf_2_react_mf_2_v5__loadShare__-BtfZ4GMG.js";import{C as d,i as _}from"./ConfigCustomTelegramSet__mf_v__runtimeInit__mf_v__-_xfUaItO.js";import"./ConfigCustomTelegramSet__loadShare__react__loadShare__-zCYRbm3Q.js";import"./_commonjsHelpers-BosuxZz1.js";import"./ConfigCustomTelegramSet__loadShare__prop_mf_2_types__loadShare__-CsTKZelb.js";import"./emotion-serialize.esm-BUa21YfQ.js";import"./ConfigCustomTelegramSet__loadShare___mf_0_emotion_mf_1_react__loadShare__-Dv339bQ6.js";import"./preload-helper-D6kgxu3v.js";const{loadShare:p}=_,{initPromise:f}=d,u=f.then(l=>p("@iobroker/json-config",{customShareInfo:{shareConfig:{singleton:!0,strictVersion:!1,requiredVersion:"*"}}})),C=await u.then(l=>l());var g=C;class x extends g.ConfigGeneric{constructor(e){super(e),this.state={...this.state,alive:!1,initialized:!1,users:[],confirm:null}}componentDidMount(){super.componentDidMount(),this.props.oContext.socket.getState(`system.adapter.telegram.${this.props.oContext.instance}.alive`).then(async e=>{e&&e.val?this.setState({alive:!0},()=>this.readData()):this.setState({alive:!1}),await this.props.oContext.socket.subscribeState(`system.adapter.telegram.${this.props.oContext.instance}.alive`,this.onAliveChanged)})}readData(){this.props.oContext.socket.sendTo(`telegram.${this.props.oContext.instance}`,"adminuser",null).then(e=>{const n=[];for(const t in e){const a=[];e[t].userName&&a.push(e[t].userName),e[t].firstName&&a.push(e[t].firstName),n.push({id:t,names:a.join(" / "),sysMessages:e[t].sysMessages})}this.setState({users:n,initialized:!0})})}async componentWillUnmount(){await this.props.oContext.socket.unsubscribeState(`system.adapter.telegram.${this.props.oContext.instance}.alive`,this.onAliveChanged)}onAliveChanged=(e,n)=>{const t=n?n.val:!1;t!==this.state.alive&&this.setState({alive:t},()=>{t&&!this.state.initialized&&this.readData()})};onSysMessageChange(e){const n=this.state.users.findIndex(t=>t.id===e);if(n!==-1){const t=!this.state.users[n].sysMessages;this.props.oContext.socket.sendTo(`telegram.${this.props.oContext.instance}`,"systemMessages",{itemId:e,checked:t}).then(a=>{if(a===e){const r=JSON.parse(JSON.stringify(this.state.users)),h=r.findIndex(m=>m.id===e);h!==-1&&(r[h].sysMessages=t,this.setState({users:r}))}})}}onDelete(e){this.props.oContext.socket.sendTo(`telegram.${this.props.oContext.instance}`,"delUser",e).then(n=>{if(n===e){const t=JSON.parse(JSON.stringify(this.state.users)),a=t.findIndex(r=>r.id===e);a!==-1&&(t.splice(a,1),this.setState({users:t}))}})}renderConfirmDialog(){return this.state.confirm?s.jsx(o.Confirm,{onClose:e=>{const n=this.state.confirm;this.setState({confirm:null},()=>e&&this.onDelete(n))}}):null}renderItem(){return!this.state.alive&&!this.state.initialized?s.jsx("div",{children:o.I18n.t("custom_telegram_not_alive")}):this.state.initialized?s.jsxs("div",{style:{width:"100%"},children:[s.jsx("h4",{children:o.I18n.t("custom_telegram_title")}),s.jsx(i.TableContainer,{component:i.Paper,style:{width:"100%"},children:s.jsxs(i.Table,{style:{width:"100%"},size:"small",children:[s.jsx(i.TableHead,{children:s.jsxs(i.TableRow,{children:[s.jsx(i.TableCell,{children:o.I18n.t("custom_telegram_id")}),s.jsx(i.TableCell,{children:o.I18n.t("custom_telegram_name")}),s.jsx(i.TableCell,{children:o.I18n.t("custom_telegram_sys_messages")}),s.jsx(i.TableCell,{})]})}),s.jsx(i.TableBody,{children:this.state.users.map(e=>s.jsxs(i.TableRow,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[s.jsx(i.TableCell,{component:"th",scope:"row",children:e.id}),s.jsx(i.TableCell,{children:e.names}),s.jsx(i.TableCell,{children:s.jsx(i.Checkbox,{disabled:!this.state.alive,checked:!!e.sysMessages,onClick:()=>this.onSysMessageChange(e.id)})}),s.jsx(i.TableCell,{children:s.jsx(i.IconButton,{disabled:!this.state.alive,onClick:()=>this.setState({confirm:e.id}),children:s.jsx(c,{})})})]},e.id))})]})}),this.renderConfirmDialog()]}):s.jsx(i.LinearProgress,{})}}const w={TelegramComponent:x};export{w as default};
//# sourceMappingURL=Components-s2wEHnJ_.js.map
